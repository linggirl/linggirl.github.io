<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title></title>
    <style>
        body {
            margin: 0;
        }

        #view {
            position: absolute;
            top: 50%;
            left: 50%;
        }

            #view > div {
                position: absolute;
                width: 100%;
                height: 100%;
            }

        .above {
            height: 10rem;
        }

        .below {
            height: 6rem;
        }

        #bAbove {
            background-color: #a080ef;
        }

        #bBelow {
            background-color: #f25e82;
        }

        #geometries > div {
            position: absolute;
        }

        #player {
            top: 12.2rem;
            left: 3.7rem;
            width: 1.6rem;
            height: 1.6rem;
            border-radius: 0.8rem;
            background-color: #6de2a9;
        }
    </style>
    <script>
        "use strict";
        var viewLeft, viewTop;
        function throttle(func) {
            var timeout;
            return function () {
                var context = this, args = arguments;
                cancelAnimationFrame(timeout);
                timeout = requestAnimationFrame(function () {
                    func.apply(context, args);
                    timeout = null;
                });
            };
        };
        function resize() {
            var viewRatio = 9 / 16;
            var winRatio = window.innerWidth / window.innerHeight;
            var w, h;
            if (viewRatio > winRatio) {
                w = innerWidth;
                h = innerWidth / viewRatio;
            }
            else {
                w = innerHeight * viewRatio;
                h = innerHeight;
            }
            var style = view.style;
            style.width = w + "px";
            style.height = h + "px";
            style.marginLeft = -w / 2 + "px";
            style.marginTop = -h / 2 + "px";
            document.documentElement.style.fontSize = w / 9 + "px";
            var rect = view.getBoundingClientRect();
            viewLeft = rect.left;
            viewTop = rect.top;
        }
        function iBelowListener(e) {
            e.preventDefault();
            var touch = e.changedTouches[0];
            var rect = player.getBoundingClientRect();
            var x0 = rect.left - viewLeft;
            var y0 = rect.top - viewTop;
            var x1 = touch.clientX - viewLeft;
            var y1 = touch.clientY - viewTop;
            var deltaX = x1 - x0;
            var deltaY = y1 - y0;
            var length = Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2));
            var sin = deltaY / length;
            var cos = deltaX / length;
            var v = 0.1;
            var vx = v * cos;
            var vy = v * sin;
            var id;
            var t = Date.now();
            var deltaT;
            var x;
            var y;
            var style = player.style;
            function render() {
                id = requestAnimationFrame(render);
                var now = Date.now();
                deltaT = now - t;
                t = now;
                x += vx * deltaT;
                if ((x1 - x) / deltaX > 0) {
                    y += vy * deltaT;
                    style.left = x + "px";
                    style.top = y + "px";
                }
                else {
                    style.left = x1 + "px";
                    style.top = y1 + "px";
                    cancelAnimationFrame(id);
                }
            }
            render();
        }
        window.onload = function () {
            window.onresize = throttle(resize);
            resize();
            iBelow.addEventListener("touchstart", iBelowListener);
        };
    </script>
</head>
<body>
    <div id="view">
        <div id="background">
            <div id="bAbove" class="above"></div>
            <div id="bBelow" class="below"></div>
        </div>
        <div id="geometries">
            <div id="player"></div>
        </div>
        <div id="interaction">
            <div id="iAbove" class="above"></div>
            <div id="iBelow" class="below"></div>
        </div>
    </div>
</body>
</html>